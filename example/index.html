<html ng-app="app">
<title>test</title>
<base href="/">
<meta name="fragment" content="!">
<script src="//code.angularjs.org/1.3.15/angular.js"></script>
<script src="//code.angularjs.org/1.3.15/angular-route.js" ></script>
<script src="/sub/client.js" ></script>
<script>

angular.module('app', [
    'ngRoute'
])
.config(function($locationProvider) {
    $locationProvider
    .html5Mode(true)
    .hashPrefix('!');
})
.config(function($routeProvider) {
    $routeProvider
    .when('/', {
        template: '<p>not callbacking</p>',
        controller: 'HomeCtrl'
    })
    .when('/page1', {
        template: '<p>{{message}}</p>',
        controller: 'Page1Ctrl'
    })
    .when('/page2', {
        template: '<ul><li ng-repeat="user in users">{{user.name}}: {{user.message}}</li></ul>',
        controller: 'Page2Ctrl'
    })
    .otherwise({
        redirectTo: '/'
    });
})
.controller('HomeCtrl', function($scope){
})
.controller('Page1Ctrl', function($scope, $timeout){
    var cb = spaseo();
    $scope.message = 'this should not be rendered..'
    $timeout(function() {
        $scope.message = 'this should be rendered!!'
        cb();
    }, 2000);
})
.controller('Page2Ctrl', function($scope, $http){
    var cb = spaseo();
    $http.get('/users.json')
    .success(function(data) {
        $scope.users = data;
        cb()
    });
})
.run(function($rootScope, $location){
    $rootScope.$location = $location;
});

</script>
<style>
a {
    text-decoration: none;
}
</style>
<body>
<h1>example page</h1>
<ul>
    <li><a href="/">top</a></li>
    <li><a href="/page1">page1</a></li>
    <li><a href="/page2">page2</a></li>
</ul>
<hr>
<div ng-view id="main">
</div>
<hr>
<p><a ng-href="{{$location.path()}}?_escaped_fragment_" target="_self">{{$location.path()}}?_escaped_fragment_ (server rendering)</a></p>
</body>
</html>
